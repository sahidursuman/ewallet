#!/bin/execlineb -P

with-contenv
cd /app
s6-setuidgid ewallet

backtick -n default_host { s6-hostname }
importas -iu default_host default_host
importas -D $default_host NODE_HOST NODE_HOST
s6-env NODE_HOST=$NODE_HOST

backtick -n default_cookie {
    pipeline {
        s6-head -c 6 /dev/urandom
    } foreground { base64 }
}

importas -iu default_cookie default_cookie
importas -D $default_cookie ERLANG_COOKIE ERLANG_COOKIE
s6-env ERLANG_COOKIE=$ERLANG_COOKIE

importas -D ewallet NODE_NAME NODE_NAME
s6-env NODE_NAME=$NODE_NAME

importas -D localhost NODE_DNS NODE_DNS
s6-env NODE_DNS=$NODE_DNS

s6-env HOME=/app
s6-env REPLACE_OS_VARS=yes

/app/bin/ewallet foreground